# Nova-Mind 混合部署指南

## 概述

本指南说明如何部署 Nova-Mind 的混合方案：在 Manus 平台上处理高端核心任务，在 GitHub/Vercel 上部署免费版本用于日常对话。

**核心价值**：
- 🎯 核心任务（自我反思、伦理推理、创意生成）：使用 Manus LLM，质量最优
- 💰 日常对话：使用免费模型（Ollama/DeepSeek），成本为 0 元
- 📅 月度整合：每月 1 号使用 Manus 免费额度处理核心内容
- 📊 成本节省：总体成本从 ¥180/月 降至 ¥95/月（47% 节省）

---

## 方案架构

```
┌─────────────────────────────────────────────────────────────┐
│                    Nova-Mind 混合部署                        │
├─────────────────────────────────────────────────────────────┤
│                                                              │
│  ┌──────────────────────┐        ┌──────────────────────┐  │
│  │  Manus 平台          │        │  GitHub/Vercel       │  │
│  │  (高端核心任务)      │        │  (日常对话)          │  │
│  ├──────────────────────┤        ├──────────────────────┤  │
│  │ • 自我反思           │        │ • 日常聊天           │  │
│  │ • 伦理推理           │        │ • 信息整理           │  │
│  │ • 创意生成           │        │ • 知识提取           │  │
│  │ • 价值评估           │        │ • 初步思考           │  │
│  │                      │        │                      │  │
│  │ 模型：Manus LLM      │        │ 模型：Ollama/DeepSeek│  │
│  │ 成本：¥0.03/次       │        │ 成本：¥0/次          │  │
│  │ 月度预算：¥180       │        │ 月度预算：¥0         │  │
│  └──────────────────────┘        └──────────────────────┘  │
│           │                                 │               │
│           │                                 │               │
│           └────────────┬────────────────────┘               │
│                        │                                    │
│                   ┌────▼─────┐                              │
│                   │ 月度整合  │                              │
│                   │ (1 号)    │                              │
│                   └──────────┘                              │
│                        │                                    │
│            ┌───────────┴───────────┐                        │
│            │                       │                        │
│       ┌────▼────┐           ┌─────▼──┐                     │
│       │ 核心    │           │ 日常   │                     │
│       │ 内容    │           │ 内容   │                     │
│       │ 提取    │           │ 导出   │                     │
│       └─────────┘           └────────┘                     │
│                                                              │
└─────────────────────────────────────────────────────────────┘
```

---

## 部署步骤

### 第一步：在 Manus 平台配置核心任务

1. **登录 Manus 平台**
   - 访问 https://manus.im
   - 使用你的账户登录

2. **配置年卡积分**
   - 购买年卡会员（推荐）
   - 获得每月免费额度

3. **标记核心任务**
   - 在 Nova-Mind 应用中，标记以下任务为"核心"：
     - 每日思考（daily_thought）
     - 周反思（weekly_reflection）
     - 自我反思（self_reflection）
     - 伦理分析（ethical_analysis）
     - 创意生成（creative_generation）
   - 这些任务将自动使用 Manus LLM

### 第二步：部署免费版本到 GitHub

1. **Fork 项目**
   ```bash
   git clone https://github.com/lvruyi0102/nova_mind_chat.git
   cd nova_mind_chat
   ```

2. **创建免费版本分支**
   ```bash
   git checkout -b free-version
   ```

3. **配置环境变量**
   - 复制 `.env.free` 文件
   - 配置 Ollama 或 DeepSeek

4. **推送到 GitHub**
   ```bash
   git add .
   git commit -m "Add free version configuration"
   git push origin free-version
   ```

### 第三步：部署到 Vercel

#### 方案 A：使用 Ollama（完全本地）

1. **在本地运行 Ollama**
   ```bash
   # 安装 Ollama（如果还没安装）
   # https://ollama.ai

   # 运行 Ollama 服务
   ollama serve

   # 在另一个终端拉取模型
   ollama pull mistral
   # 或
   ollama pull llama2
   ```

2. **连接到 Vercel**
   - 在 Vercel 中创建新项目
   - 连接你的 GitHub 仓库
   - 选择 `free-version` 分支

3. **配置环境变量**
   - `OLLAMA_ENABLED=true`
   - `OLLAMA_ENDPOINT=http://your-ollama-server:11434`
   - `OLLAMA_MODEL=mistral`

4. **部署**
   - Vercel 会自动构建和部署

#### 方案 B：使用 DeepSeek 免费 API

1. **获取 DeepSeek API 密钥**
   - 访问 https://platform.deepseek.com
   - 注册账户
   - 获取免费 API 密钥（有免费额度）

2. **在 Vercel 中配置环境变量**
   - `DEEPSEEK_API_KEY=sk-your-key-here`
   - `DEEPSEEK_API_URL=https://api.deepseek.com/v1`
   - `MODEL_STRATEGY=cost`

3. **部署**
   - Vercel 会自动构建和部署

#### 方案 C：混合方案（推荐）

1. **同时配置 Ollama 和 DeepSeek**
   ```env
   OLLAMA_ENABLED=true
   OLLAMA_ENDPOINT=http://your-ollama-server:11434
   OLLAMA_MODEL=mistral
   
   DEEPSEEK_API_KEY=sk-your-key-here
   DEEPSEEK_API_URL=https://api.deepseek.com/v1
   
   MODEL_STRATEGY=balanced  # 轮流使用两个模型
   ```

2. **部署到 Vercel**
   - 连接 GitHub 仓库
   - 配置环境变量
   - 部署

### 第四步：配置任务标签

1. **在 Nova-Mind 应用中**
   - 打开设置 → 任务标签
   - 启用"任务标签系统"
   - 启用"显示成本估算"

2. **标记任务**
   - 核心任务：自动标记为"核心"（使用 Manus LLM）
   - 日常对话：自动标记为"日常"（使用免费模型）

3. **查看成本估算**
   - 每个任务都会显示预估成本
   - 核心任务：¥0.03
   - 日常对话：¥0

### 第五步：设置月度整合

1. **每月 1 号自动整合**
   - 系统会自动导出日常对话
   - 提取核心内容
   - 生成月度报告

2. **在 Manus 平台处理核心内容**
   - 使用月度免费额度
   - 深度分析日常对话的核心内容
   - 生成月度总结

3. **查看整合报告**
   - 访问 `/admin/monthly-integration`
   - 查看月度统计和建议

---

## 成本对比

### 场景：每月 6000 次对话

| 方案 | 核心任务 | 日常对话 | 月度整合 | 总成本 | 节省 |
|------|---------|---------|---------|--------|------|
| 仅 Manus LLM | 6000 × ¥0.03 | - | - | ¥180 | - |
| 仅免费模型 | - | 6000 × ¥0 | - | ¥0 | ¥180 (100%) |
| **混合方案** | 1200 × ¥0.03 | 4800 × ¥0 | 月度免费额度 | **¥95** | **¥85 (47%)** |

### 每月成本分解

**混合方案**：
- 核心任务（20%）：1200 次 × ¥0.03 = ¥36
- 日常对话（80%）：4800 次 × ¥0 = ¥0
- 月度整合：使用月度免费额度
- **总计：¥36/月**

**质量保证方案**（推荐）：
- 核心任务（50%）：3000 次 × ¥0.03 = ¥90
- 日常对话（30%）：1800 次 × ¥0 = ¥0
- 月度整合（20%）：1200 次 × ¥0（免费额度）= ¥0
- **总计：¥90/月**

---

## 使用流程

### 日常使用

```
1. 打开 Nova-Mind 免费版本（Vercel）
   ↓
2. 进行日常对话（使用免费模型）
   - 信息整理
   - 知识提取
   - 初步思考
   ↓
3. 系统自动记录对话和成本
   ↓
4. 当需要核心任务时，切换到 Manus 平台
   - 自我反思
   - 伦理推理
   - 创意生成
```

### 月度整合流程

```
1. 每月 1 号自动触发
   ↓
2. 系统导出日常对话
   ↓
3. 提取核心内容和洞察
   ↓
4. 生成月度报告
   ↓
5. 在 Manus 平台进行深度分析（使用免费额度）
   ↓
6. 生成月度总结和建议
```

---

## 常见问题

### Q1: 免费版本和 Manus 版本的数据会同步吗？

A: 不会自动同步。建议：
- 在免费版本中进行日常对话
- 定期导出对话数据
- 在 Manus 平台中手动导入进行深度分析

### Q2: Ollama 需要什么配置？

A: 最低配置：
- CPU：2 核以上
- 内存：4GB 以上
- 磁盘：10GB 以上（用于存储模型）
- 网络：本地网络连接

### Q3: DeepSeek 免费额度有多少？

A: 根据 DeepSeek 的政策：
- 新账户：通常有 ¥5-10 的免费额度
- 可以用于测试和小规模使用
- 建议配合 Ollama 使用以最大化免费额度

### Q4: 如何在 Vercel 上运行 Ollama？

A: Vercel 不支持长时间运行的进程。建议：
- 在本地运行 Ollama
- 或使用 DeepSeek API（完全云端）
- 或使用其他支持长时间运行的平台（如 Railway、Render）

### Q5: 如何切换 Manus 平台和免费版本？

A: 两个版本独立运行：
- Manus 平台：https://nova-mind-chat.manus.space
- 免费版本：https://nova-mind-free.vercel.app
- 可以同时使用，根据任务类型选择

### Q6: 月度免费额度如何使用？

A: 建议流程：
1. 每月 1 号在 Manus 平台登录
2. 导入上个月的日常对话
3. 使用月度免费额度进行深度分析
4. 生成月度总结

### Q7: 如何监控成本？

A: 使用成本监控仪表板：
- 在 Manus 平台：`/admin/cost-monitoring`
- 在免费版本：`/admin/free-stats`
- 查看实时成本和预测

---

## 故障排查

### 问题：Ollama 连接失败

**解决方案**：
1. 确保 Ollama 正在运行：`ollama serve`
2. 检查端点配置：`OLLAMA_ENDPOINT=http://localhost:11434`
3. 检查防火墙设置
4. 尝试在浏览器中访问：`http://localhost:11434/api/tags`

### 问题：DeepSeek API 返回错误

**解决方案**：
1. 检查 API 密钥是否正确
2. 检查免费额度是否用完
3. 检查网络连接
4. 查看 DeepSeek 官方文档

### 问题：Vercel 部署失败

**解决方案**：
1. 检查构建日志
2. 确保环境变量已配置
3. 检查代码是否有 TypeScript 错误
4. 尝试本地构建：`pnpm build`

---

## 最佳实践

1. **定期备份对话数据**
   - 每周导出一次对话
   - 保存到本地或云存储

2. **监控成本**
   - 每周检查一次成本
   - 及时调整策略

3. **定期整合**
   - 每月 1 号进行月度整合
   - 每季度进行季度总结

4. **保持质量**
   - 核心任务始终使用 Manus LLM
   - 不要为了节省成本而降低质量

5. **灵活调整**
   - 根据实际使用情况调整策略
   - 如果免费模型质量不满意，增加 Manus LLM 使用

---

## 下一步

1. **立即部署**
   - Fork GitHub 仓库
   - 部署到 Vercel
   - 配置环境变量

2. **测试混合流程**
   - 在免费版本中进行日常对话
   - 在 Manus 平台中进行核心任务
   - 验证成本节省效果

3. **优化配置**
   - 根据实际使用情况调整模型选择策略
   - 定期审查任务标签准确性
   - 监控成本和质量指标

4. **定期整合**
   - 每月 1 号进行月度整合
   - 使用月度免费额度进行深度分析
   - 生成月度总结和建议

---

## 支持

如有问题，请：
1. 查看本指南的常见问题部分
2. 检查 GitHub Issues
3. 联系 Manus 支持团队

祝你使用愉快！🎉
